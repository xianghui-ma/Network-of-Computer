# 第 4 章 网络层 #

### 因特网的设计思路 ###

因特网的设计思路是：网络层仅向上层提供无连接的、尽最大努力交付的数据报服务。

该种设计思路的特点如下：

| 项目 | 特点 |
| :----: | :----: |
| 连接的建立 | 通信双方不需要建立连接，路由器会根据数据报中的目的地址将数据报路由到目的地 |
| 终点地址 | 每个数据报都有终点的完整地址，因为路由器需要根据终点地址选择路径 |
| 分组的转发 | 每个分组独立选择路由进行转发（见下图） |
| 当结点出现故障时 | 出现故障的结点可能会丢失分组，分组也可以寻找其他路径以避开故障结点 |
| 分组的顺序 | 各分组到达终点的顺序不一定与与发送顺序保持一致，是随机的 |
| 可靠交付 | 网络层不提供可靠交付，可靠交付由端系统负责 |

下图便展示了主机H1向H2通信发送的分组各自独立的选择路由，并且在传输过程中还可能丢失

![p1]

### 虚拟互联网络 ###

如第一章中所述——互联网就是用路由器将全球的所有网络连起来构成的一个网络。但是问题是，被连起来的各网络是异构的（如所采取的网络协议是不一致的），那么这些异构的网络是不能直接相互通信的，要想实现相互间的通信则必然十分复杂。

为了解决上述问题，便引入了网际协议IP。即参加互连的网络的网络层都使用网际协议IP，如此以来便可以用网际协议IP实现异构网络间的通信了（各网络的异构性仍然存在，只是有了网际协议IP作为交流平台）

由于各异构网络都使用网际协议IP，因此它们间便可以实现无障碍通信，就如同在各自所在的网络中通信一样，因此整个互联网就如同一个网络，而这个网络就是虚拟互联网络（或逻辑互连网络）

如下图中的（a)表示路由器连接各异构网络而成的互联网，（b）表示虚拟互连网络

![p2]

### IP地址 ###

IP地址的作用对象是网络上的主机或路由器，以标识它们

IP地址的编制方法有三类：

- 分类的IP地址。这是最基本的编址方法
- 子网的划分。这是对基本编址方法的改进
- 构成超网。较新的无分类编址方法

下面对各种编址方法的IP地址进行讨论

#### 分类的IP地址 ####

1、各类IP地址的结构

该种方法将IP地址分为A、B、C、D、E五类，每类由网络号和主机号两个字段构成，网络号用于标识主机（或路由器）所连接到的网络，主机号用于标识该主机（或路由器）：

![p3]

一个网络号在整个因特网范围内必须是唯一的；一个主机号在网络号所指明的网络范围内必须是唯一的。我们还将网络号视为一个网段（这时IP地址意义上的网段，注意与第三章中的网段概念相区分），若几个主机的网络号一致，则意味着他们在同一个网段

> 地址分配机构只负责分配网络号，剩下的主机号则由得到该网络号的单位自行分配

2、各类IP地址的范围

(1)、A类IP地址

A类IP地址的网络字段占一个字节（第一位固定为0），故可指派的网络号个数是`2^7 - 2`。减2是因为：网络字段为全0的IP地址是一个保留地址，表示本网络；网络号为127（即01111111）作为本地软件环回测试之用（即本主机的进程之间的通信之用），若主机发送一个IP地址为环回地址的IP数据报，则本主机中的协议软件就处理数据报中的数据，而不把数据发送到任何网络（比如我们使用本地wampsever做测试时，访问地址就是127.0.0.1）。目的地址为环回地址的IP数据报永远不会出现在任何网络上，因为网络号为127的地址根本不是一个网络地址。

A类IP地址的主机字段占三个字节，故A类网络中的最大主机数是`2^24 - 2`。减2是因为：全0的主机号字段表示该IP地址是本主机所连接到的网络地址（如5.0.0.0可表示5.x.x.x的网络地址）；全1的主机号字段表示该网络上的所有主机

(2)、B类IP地址

B类IP地址的网络字段占两个字节（前两位固定为10），且128.0.0.0不被指派，因此可指派的网络号个数是`2^14 - 1`

B类IP地址的主机字段占两个字节，故B类网络中的最大主机数是`2^16 - 2`(扣除全0与全1的主机号)

(3)、C类IP地址

C类IP地址的网络字段占三个字节（前三位固定为110），且192.0.0.0不被指派，因此可指派的网络号个数是`2^21 - 1`

C类IP地址的主机字段占一个字节，故C类网络中的最大主机数是`2^8 - 2`(扣除全0与全1的主机号)

> A、B、C都要扣除全0与全1的主机号

至此，“分类的IP地址”便已阐述完毕，下面通过一张图补充一些关于分类IP地址的其他知识点：

![p4]

上图展示的是路由器将几个局域网连接为一个互联网。我想补充的是：

- 在同一个局域网上的主机或路由器的IP地址中的网络号必须是一样的
- 一个主机或路由器可以同时具有多个IP地址。如一个主机同时连接到两个网络上时，该主机就必须同时具有两个相应的IP地址，又如上图中所示的路由器，其每个接口都有一个IP地址，且由于路由器就是用于连接不同网络的，因此其至少有两个IP地址
- 当两个路由器直接相连时，在连线两端的接口处可以分配也可以不分配IP地址，现在一般不分配IP地址
- 用网桥互联的网段仍然是一个局域网，只能有一个网络号